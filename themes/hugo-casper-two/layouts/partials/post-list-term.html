{{ $pages := ((where .Site.Pages "Type" "post") | shuffle) }}
{{ range first 3 $pages}} 

<article class="post-card post">
    {{if .Params.image}}
    <a class="post-card-image-link" href="{{ .Permalink }}">
      <div class="post-card-image" style="background-image: url({{.Params.image | absURL}})"></div>
    </a>

    {{else if .Resources.GetMatch "card-cover-image"}}
    {{ $coverImage := .Resources.GetMatch "card-cover-image" }}
    {{ $resizedCover := $coverImage.Resize .Site.Params.cardThumbSize }}
    <a class="post-card-image-link" href="{{ .Permalink }}">
      <div class="post-card-image" style="background-image: url({{ $resizedCover.Permalink }})"></div>
    </a>

    {{else if .Resources.GetMatch "cover-image"}}
    {{ $coverImage := .Resources.GetMatch "cover-image" }}
    {{ $resizedCover := $coverImage.Resize .Site.Params.cardThumbSize }}
    <a class="post-card-image-link" href="{{ .Permalink }}">
      <div class="post-card-image" style="background-image: url({{ $resizedCover.Permalink }})"></div>
    </a>

    {{else}}
    <a class="post-card-image-link" href="{{ .Permalink }}">
      <div class="post-card-image" style="background-image: url({{$.Site.BaseURL}}defimg/{{ index (seq 7 | shuffle) 0 }}.jpg)"></div>
    </a>    
    {{end}}

    <div class="post-card-content">
      <a class="post-card-content-link" href="{{ .Permalink }}">
          <header class="post-card-header">
              {{with .Params.categories }}
                <!-- luam prima categorie din articol si, daca are definitie in Site Data,
                ii citim culoarea si o punem la bordura de pe card -->
                {{ $primaCategorieDinArticol := lower (index . 0) }}
                {{ $cat := index $.Site.Data.categorii $primaCategorieDinArticol }}
                {{ $culoare := $cat.culoare_bordura | default "" }}

                <div class="post-card-categories" style="border-color: {{ $culoare | safeCSS }}">
                  {{ range $index, $articleCateg := . }}
                    {{if $index}}/{{end}}
                    {{ $categorieSiteData := index $.Site.Data.categorii (lower $articleCateg) }}
                    {{ $categorie := $categorieSiteData.nume | default $articleCateg }}
                    <span class = "{{ lower $categorie }}">{{$categorie}}</span>
                  {{end}}
                </div>
              {{end}}
              <h2 class="post-card-title">{{.Title}}</h2>
              {{/*if .Params.tags }}<span class="post-card-tags">{{ range $index, $tag := .Params.tags }}
              #{{$tag}} {{end}} </span>
              {{ end */}}
              {{with .Params.subtitle}}<span class="post-card-subtitle">{{.}}</span>{{end}}
          </header>
          <section class="post-card-excerpt">
              {{ if .Description }} 
                <p>{{ .Description | markdownify }}</p>
              {{else}}
                <p>{{ .Summary | plainify | safeHTML }}{{ if .Truncated }} ... {{end}} </p>
              {{end}}
          </section>
      </a>

      <footer class="post-card-meta">
          {{$author := index .Site.Data.authors (or .Params.authors .Site.Params.author)}}
          {{$authorName := $author.name  }}
          {{$authorThumbnail := $author.thumbnail }}
          {{$authorLink := .Params.authors }}

          {{ $authorThumbnailFile := printf "/img/author-avatars/%s" (or $authorThumbnail .Site.Params.authorAvatar) }}
          <img class="author-profile-image" src="{{ $authorThumbnailFile }}" alt="{{ $authorName }}" />
          <div>
            <span class="post-card-author"><a href="/authors/{{$authorLink}}">{{ $authorName }}</a></span>
            <span class="post-card-date">{{ .Date.Format "2/01/06" | safeHTML }}</span>
          </div>
          <div class="post-card-reading-time">
              {{if .Resources.ByType "audio"}}
                  <span title="Versiune audio">
                      <svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="32" height="32" viewBox="0 0 75 75">
                            <path d="M39.389,13.769 L22.235,28.606 L6,28.606 L6,47.699 L21.989,47.699 L39.389,62.75 L39.389,13.769z" style="stroke:#969696;stroke-width:5;stroke-linejoin:round;fill:#969696;"/>
                            <path d="M48,27.6a19.5,19.5 0 0 1 0,21.4M55.1,20.5a30,30 0 0 1 0,35.6M61.6,14a38.8,38.8 0 0 1 0,48.6" style="fill:none;stroke:#969696;stroke-width:5;stroke-linecap:round"/>
                      </svg>
                  </span>
              {{end}}
              <span title="Timp citire">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 237.54 237.54" style="enable-background:new 0 0 237.54 237.54" xml:space="preserve">
                    <path d="M118.77,0c32.8,0,62.49,13.29,83.98,34.79c21.49,21.49,34.79,51.19,34.79,83.98s-13.29,62.49-34.79,83.98 c-21.49,21.49-51.19,34.79-83.98,34.79c-32.8,0-62.49-13.29-83.98-34.79C13.29,181.26,0,151.56,0,118.77s13.29-62.49,34.79-83.98 C56.28,13.29,85.97,0,118.77,0L118.77,0z M109.06,60.2c0-3.59,2.91-6.5,6.5-6.5s6.5,2.91,6.5,6.5v60l45.14,26.76 c3.08,1.82,4.11,5.8,2.29,8.89c-1.82,3.08-5.8,4.11-8.89,2.29l-47.99-28.45c-2.11-1.08-3.55-3.27-3.55-5.79V60.2L109.06,60.2z M193.56,43.98C174.42,24.84,147.98,13,118.77,13c-29.21,0-55.65,11.84-74.79,30.98C24.84,63.12,13,89.56,13,118.77 c0,29.21,11.84,55.65,30.98,74.79c19.14,19.14,45.58,30.98,74.79,30.98c29.21,0,55.65-11.84,74.79-30.98 c19.14-19.14,30.98-45.58,30.98-74.79C224.54,89.56,212.7,63.12,193.56,43.98L193.56,43.98z"/>
                </svg>
                {{.ReadingTime}}
              </span>
          </div>
      </footer>
    </div>
</article>
{{ end }}
